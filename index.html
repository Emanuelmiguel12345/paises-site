<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Acerte a Bandeira</title>

<!-- Fonte display moderna -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Changa+One:ital@0;1&display=swap" rel="stylesheet">

<style>
/* ========= VARS ========= */
:root{
 --bg:#f4f4f4; --card:#fff; --text:#000; --accent:#0077ff;
 --r:12px; --s:0 4px 12px rgba(0,0,0,.12); --t:.35s cubic-bezier(.4,0,.2,1);
 font-size:16px
}
[data-theme=dark]{--bg:#121212;--card:#1e1e1e;--text:#f5f5f5;--s:0 4px 12px rgba(0,0,0,.6)}
*{box-sizing:border-box;margin:0;padding:0}
body{display:flex;flex-direction:column;align-items:center;gap:1rem;min-height:100vh;
     background:var(--bg);color:var(--text);font-family:system-ui,Roboto,sans-serif;
     transition:background var(--t),color var(--t)}
h1{font-family:"Changa One",cursive;font-size:2.8rem;text-align:center;user-select:none}

/* ========= COMPONENTES ========= */
.card{background:var(--card);border-radius:var(--r);box-shadow:var(--s);
      padding:2rem 1.5rem;width:100%;max-width:520px;display:flex;flex-direction:column;gap:1rem;
      transition:background var(--t)}
#flag{width:100%;max-width:320px;height:220px;border-radius:var(--r);
      object-fit:cover;box-shadow:var(--s);align-self:center;opacity:0;transform:scale(.95);
      transition:opacity .5s ease,transform .5s ease}
.show#flag{opacity:1;transform:scale(1)}
input,button{font:inherit;border:none;border-radius:var(--r);outline:none}
input{padding:.8rem 1rem;background:var(--bg);color:var(--text)}
input:focus{box-shadow:0 0 0 2px var(--accent)}
button{cursor:pointer;transition:filter .25s}
button:hover{filter:brightness(1.1)}
.feedback{min-height:1.6rem;font-weight:600}
#timer{font-weight:600}
.gear{background:none;font-size:1.8rem}

/* painel deslizante */
aside{position:fixed;top:0;right:0;width:300px;height:100%;padding:2rem 1.5rem;
      background:var(--card);box-shadow:var(--s);display:flex;flex-direction:column;gap:1rem;
      transform:translateX(100%);transition:transform var(--t),background var(--t);z-index:1000}
.open{transform:translateX(0)}
fieldset{border:none;padding:0;display:flex;flex-direction:column;gap:.3rem}
label{display:flex;align-items:center;gap:.5rem}
.actions{margin-top:auto;display:flex;gap:.5rem}
.actions button{flex:1;padding:.9rem;background:var(--accent);color:#fff;font-weight:700}

/* ====== ANIMA√á√ïES ====== */
@keyframes shake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}
30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}
.correct{animation:shake .4s both}

/* ====== RESPONSIVO ====== */
@media(max-width:420px){#flag{height:180px}}
</style>

<body>
<header style="width:100%;max-width:520px;display:flex;justify-content:space-between;align-items:center">
  <h1>Acerte a Bandeira</h1>
  <button id="gear" class="gear" aria-label="Configura√ß√µes">‚öôÔ∏è</button>
</header>

<main class="card" aria-live="polite">
  <img id="flag" alt="Bandeira">
  <input id="answer" placeholder="Digite o pa√≠s e pressione Enter" autocomplete="off">
  <div class="feedback" id="feedback"></div>
  <div id="score">Pontua√ß√£o: 0 / 0</div>
  <div id="timer"></div>
</main>

<aside id="panel">
  <h2>Configura√ß√µes</h2>
  <fieldset><legend>Continentes</legend>
    <label><input type="checkbox" value="Africa"   class="c"> √Åfrica</label>
    <label><input type="checkbox" value="Americas" class="c"> Am√©ricas</label>
    <label><input type="checkbox" value="Asia"     class="c"> √Åsia</label>
    <label><input type="checkbox" value="Europe"   class="c"> Europa</label>
    <label><input type="checkbox" value="Oceania"  class="c"> Oceania</label>
  </fieldset>
  <label>Tempo (3-30s): <input type="number" id="t" min="3" max="30"></label>
  <label>Rodadas (0=‚àû): <input type="number" id="r" min="0" max="500"></label>
  <label><input type="checkbox" id="dark"> Modo escuro</label>
  <div class="actions"><button id="go">Salvar ‚Ä¢ Iniciar</button></div>
</aside>

<script>
/* ====== STATE & HELPERS ====== */
const S={all:[],list:[],cur:null,sc:0,rd:0,max:0,time:10,timer:null},
  $=q=>document.querySelector(q),A=[...document.querySelectorAll('.c')],
  F=$('#flag'),I=$('#answer'),P=$('#panel'),fb=$('#feedback'),sc=$('#score'),tm=$('#timer');
const rm=a=>a.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();
const load=()=>JSON.parse(localStorage.getItem('flags')||'{}');
const save=p=>localStorage.setItem('flags',JSON.stringify(p));

/* ====== CONFIG PANEL ====== */
$('#gear').onclick=()=>P.classList.toggle('open');
$('#dark').onchange=e=>document.documentElement.dataset.theme=e.target.checked?'dark':'light';
$('#go').onclick=()=>{
  const pref={c:A.filter(x=>x.checked).map(x=>x.value),t:+$('#t').value||10,r:+$('#r').value||0,d:$('#dark').checked};
  save(pref); P.classList.remove('open'); start(pref)
};

/* ====== FETCH COUNTRIES ====== */
(async()=>{
  const data=await (await fetch('https://restcountries.com/v3.1/all')).json();
  S.all=data.map(c=>({pt:c.translations?.por?.common??c.name.common,en:c.name.common,cd:c.cca2.toLowerCase(),co:c.continents}));
  const p=load(); // aplica prefs salvas
  if(p.c)A.forEach(x=>x.checked=p.c.includes(x.value));
  if(p.t)$('#t').value=p.t; if(p.r!==undefined)$('#r').value=p.r;
  if(p.d!==undefined){$('#dark').checked=p.d;document.documentElement.dataset.theme=p.d?'dark':'light'}
  start(p)
})().catch(()=>alert('Falha ao buscar pa√≠ses :('));

/* ====== GAME FLOW ====== */
function start(p={}){clearInterval(S.timer);Object.assign(S,{sc:0,rd:0,max:p.r||0,time:p.t||10});
  S.list=S.all.filter(c=>p.c?.length?p.c.some(v=>c.co.includes(v)):1);
  next()}
function next(){
  if(S.max&&S.rd>=S.max){fb.textContent=`üéâ Fim! Voc√™ acertou ${S.sc} de ${S.max}.`;F.src='';tm.textContent='';return}
  S.cur=S.list[Math.random()*S.list.length|0]; F.classList.remove('show');
  F.onload=()=>F.classList.add('show');
  F.src=`https://flagcdn.com/w320/${S.cur.cd}.png`;F.alt=`Bandeira de ${S.cur.pt}`;
  I.value='';I.focus();fb.textContent='';sc.textContent=`Pontua√ß√£o: ${S.sc} / ${S.rd}`;timer()}
function timer(){
  let t=S.time; tm.textContent=`‚è±Ô∏è ${t}s`;clearInterval(S.timer);
  S.timer=setInterval(()=>{tm.textContent=`‚è±Ô∏è ${--t}s`;if(t<=0){clearInterval(S.timer);check('')}},1e3)}
function check(txt){
  clearInterval(S.timer);S.rd++;
  const g=rm(txt),ok=g&&[rm(S.cur.pt),rm(S.cur.en)].includes(g);
  fb.textContent=ok?'‚úÖ Acertou!':`‚ùå Era: ${S.cur.pt} (${S.cur.en})`;
  if(ok){S.sc++;sc.classList.add('correct');setTimeout(()=>sc.classList.remove('correct'),400)}
  sc.textContent=`Pontua√ß√£o: ${S.sc} / ${S.rd}`;setTimeout(next,900)}
I.onkeydown=e=>e.key==='Enter'&&(check(I.value),e.preventDefault());
I.onblur=()=>I.focus();
</script>
</body>
</html>
