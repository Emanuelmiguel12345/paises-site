<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Acerte a Bandeira</title>

  <!-- Fonte display moderna (Google Fonts, carrega r√°pido e √© gratuita) -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Bungee+Shade&display=swap" rel="stylesheet">

  <style>
    /* ---------- Vari√°veis de Tema ---------- */
    :root{
      --bg:#f4f4f4;
      --card:#ffffff;
      --text:#000000;
      --accent:#0066ff;
      --radius:12px;
      --shadow:0 4px 12px rgba(0,0,0,.1);
      --speed:.3s;
      font-size:16px;
    }
    [data-theme="dark"]{
      --bg:#121212;
      --card:#1e1e1e;
      --text:#f5f5f5;
      --shadow:0 4px 12px rgba(0,0,0,.6);
    }

    /* ---------- Reset & Global ---------- */
    *{ box-sizing:border-box; margin:0; padding:0; }
    body{
      font-family:system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background:var(--bg);
      color:var(--text);
      display:flex;
      flex-direction:column;
      align-items:center;
      min-height:100vh;
      padding:2rem 1rem;
      transition:background var(--speed), color var(--speed);
    }

    h1{
      font-family:"Bungee Shade", cursive;
      font-size:2.5rem;
      margin-bottom:1rem;
      text-align:center;
      user-select:none;
    }
    button, input{
      font-family:inherit;
      border:none;
      outline:none;
    }
    button{
      cursor:pointer;
      transition:filter var(--speed);
    }
    button:hover{ filter:brightness(1.1); }

    /* ---------- Layout Principal ---------- */
    .quiz-card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      width:100%;
      max-width:500px;
      padding:2rem 1.5rem;
      display:flex;
      flex-direction:column;
      gap:1rem;
      align-items:center;
      transition:background var(--speed);
    }
    #flag{
      width:320px; height:220px;
      border-radius:var(--radius);
      object-fit:cover;
      box-shadow:var(--shadow);
      background:#ddd;
    }
    #answer{
      width:100%;
      padding:.75rem 1rem;
      border-radius:var(--radius);
      background:var(--bg);
      color:var(--text);
    }
    #answer:focus{ box-shadow:0 0 0 2px var(--accent); }

    .score{ font-weight:bold; }
    .feedback{ min-height:1.5rem; }

    /* ---------- Header e Config ---------- */
    .header{
      width:100%;
      max-width:500px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:1rem;
    }
    .gear{
      background:none;
      font-size:1.5rem;
      color:var(--text);
    }

    /* ---------- Painel Lateral ---------- */
    .config-panel{
      position:fixed;
      top:0; right:0;
      width:300px;
      height:100%;
      background:var(--card);
      box-shadow:var(--shadow);
      padding:2rem 1.5rem;
      transform:translateX(100%);
      transition:transform var(--speed), background var(--speed);
      display:flex;
      flex-direction:column;
      gap:1rem;
      z-index:1000;
    }
    .config-panel.open{ transform:translateX(0); }
    .config-panel h2{ margin-bottom:.5rem; font-size:1.25rem; }
    .config-panel label{ display:flex; align-items:center; gap:.5rem; margin-bottom:.5rem; }
    .config-panel input[type="number"], .config-panel input[type="range"]{
      width:100%;
    }
    .config-panel .actions{
      margin-top:auto;
      display:flex; gap:.5rem;
    }
    .config-panel .actions button{
      flex:1;
      padding:.75rem;
      border-radius:var(--radius);
      background:var(--accent);
      color:#fff;
      font-weight:bold;
    }

    /* ---------- Responsivo ---------- */
    @media(max-width:400px){
      #flag{ width:260px; height:180px; }
    }
  </style>
</head>
<body>

  <!-- Cabe√ßalho ‚Üí T√≠tulo + Bot√£o Config -->
  <header class="header">
    <h1>Acerte a Bandeira</h1>
    <button id="openConfig" class="gear" aria-label="Abrir configura√ß√µes">‚öôÔ∏è</button>
  </header>

  <!-- Cart√£o do Quiz -->
  <main class="quiz-card" aria-live="polite">
    <img id="flag" alt="Bandeira do pa√≠s">
    <input id="answer" type="text" placeholder="Digite o pa√≠s e pressione Enter" autocomplete="off">
    <div class="feedback" id="feedback"></div>
    <div class="score" id="score">Pontua√ß√£o: 0 / 0</div>
    <div id="timer"></div>
  </main>

  <!-- Painel de Configura√ß√µes -->
  <aside class="config-panel" id="configPanel">
    <h2>Configura√ß√µes</h2>

    <fieldset>
      <legend>Continentes</legend>
      <label><input type="checkbox" value="Africa"   class="contCB"> √Åfrica</label>
      <label><input type="checkbox" value="Americas" class="contCB"> Am√©ricas</label>
      <label><input type="checkbox" value="Asia"     class="contCB"> √Åsia</label>
      <label><input type="checkbox" value="Europe"   class="contCB"> Europa</label>
      <label><input type="checkbox" value="Oceania"  class="contCB"> Oceania</label>
    </fieldset>

    <label>Tempo por rodada (s):
      <input type="number" id="timeInput" min="3" max="30" step="1">
    </label>

    <label>N¬∫ de rodadas (0 = infinito):
      <input type="number" id="roundsInput" min="0" max="500" step="1">
    </label>

    <label><input type="checkbox" id="darkToggle"> Modo escuro</label>

    <div class="actions">
      <button id="saveStart">Salvar &nbsp;‚Ä¢&nbsp; Iniciar</button>
    </div>
  </aside>

  <script>
  /* ============================================================
   *  Acerte a Bandeira ‚Äî Jogo de Quiz
   *  (c) 2025 ‚Äî Vanilla JS, sem depend√™ncias externas
   * ============================================================*/

  // ---------- Estado Global ----------
  const state = {
    countries: [],
    filtered: [],
    current: null,
    score: 0,
    rounds: 0,
    maxRounds: 0,
    timer: null,
    timePerRound: 10
  };

  // ---------- Elementos ----------
  const flagImg   = document.getElementById('flag');
  const answerInp = document.getElementById('answer');
  const feedback  = document.getElementById('feedback');
  const scoreBox  = document.getElementById('score');
  const timerBox  = document.getElementById('timer');
  const cfgPanel  = document.getElementById('configPanel');
  const openCfg   = document.getElementById('openConfig');
  const saveBtn   = document.getElementById('saveStart');
  const timeInput = document.getElementById('timeInput');
  const roundsInput = document.getElementById('roundsInput');
  const darkToggle = document.getElementById('darkToggle');
  const contCBs   = document.querySelectorAll('.contCB');

  // ---------- Utilidades ----------
  const sleep = ms => new Promise(r => setTimeout(r, ms));
  const removeAccents = str => str.normalize("NFD").replace(/[\u0300-\u036f]/g, '');

  const savePrefs = () => {
    const prefs = {
      continents:[...contCBs].filter(cb=>cb.checked).map(cb=>cb.value),
      time:+timeInput.value,
      rounds:+roundsInput.value,
      dark:darkToggle.checked
    };
    localStorage.setItem('flagQuizPrefs', JSON.stringify(prefs));
  };
  const loadPrefs = () => {
    const p = JSON.parse(localStorage.getItem('flagQuizPrefs')||'{}');
    if(p.continents) contCBs.forEach(cb=>cb.checked = p.continents.includes(cb.value));
    if(p.time) timeInput.value = p.time;
    if(p.rounds !== undefined) roundsInput.value = p.rounds;
    if(p.dark!==undefined){
      darkToggle.checked=p.dark;
      document.documentElement.dataset.theme = p.dark?'dark':'light';
    }
  };

  // ---------- Config Panel ----------
  openCfg.addEventListener('click', ()=> cfgPanel.classList.toggle('open'));
  darkToggle.addEventListener('change', ()=>{
    document.documentElement.dataset.theme = darkToggle.checked ? 'dark' : 'light';
  });

  saveBtn.addEventListener('click', ()=>{
    savePrefs();
    cfgPanel.classList.remove('open');
    initGame();
  });

  // ---------- Fetch Inicial ----------
  (async ()=>{
    try{
      const res = await fetch('https://restcountries.com/v3.1/all');
      const data = await res.json();
      state.countries = data.map(c=>({
        namePt:c.translations?.por?.common??c.name.common,
        nameEn:c.name.common,
        code:c.cca2.toLowerCase(),
        continents:c.continents
      }));
      loadPrefs();
      initGame();
    }catch(err){
      alert('Falha ao carregar pa√≠ses. Tente novamente.');
      console.error(err);
    }
  })();

  // ---------- L√≥gica Principal ----------
  function initGame(){
    // prefer√™ncias
    state.score=0;
    state.rounds=0;
    const continentsSelected = [...contCBs].filter(cb=>cb.checked).map(cb=>cb.value);
    state.timePerRound = Math.min(30, Math.max(3, +timeInput.value||10));
    state.maxRounds = +roundsInput.value||0;

    // filtrar pa√≠ses
    state.filtered = state.countries.filter(c=>{
      return continentsSelected.length ? c.continents.some(cont=>continentsSelected.includes(cont)) : true;
    });
    if(!state.filtered.length){
      alert('Selecione ao menos um continente!');
      return;
    }
    nextRound();
  }

  function nextRound(){
    clearInterval(state.timer);
    if(state.maxRounds && state.rounds>=state.maxRounds){
      feedback.textContent = `üéâ Fim! Voc√™ acertou ${state.score} de ${state.maxRounds}.`;
      flagImg.src='';
      timerBox.textContent='';
      return;
    }
    state.rounds++;
    scoreBox.textContent = `Pontua√ß√£o: ${state.score} / ${state.rounds-1}`;
    answerInp.value='';
    answerInp.focus();
    // sortear
    state.current = state.filtered[Math.floor(Math.random()*state.filtered.length)];
    flagImg.src=`https://flagcdn.com/w320/${state.current.code}.png`;
    flagImg.alt=`Bandeira de ${state.current.namePt}`;
    feedback.textContent='';
    startTimer();
  }

  function startTimer(){
    let t = state.timePerRound;
    timerBox.textContent = `‚è±Ô∏è ${t}s`;
    state.timer = setInterval(()=>{
      t--;
      timerBox.textContent = `‚è±Ô∏è ${t}s`;
      if(t<=0){ clearInterval(state.timer); handleAnswer(''); }
    },1000);
  }

  function handleAnswer(text){
    clearInterval(state.timer);
    const guess = removeAccents(text.trim().toLowerCase());
    const namePt = removeAccents(state.current.namePt.toLowerCase());
    const nameEn = removeAccents(state.current.nameEn.toLowerCase());

    if(guess && (namePt===guess || nameEn===guess)){
      state.score++;
      feedback.textContent='‚úÖ Acertou!';
    }else{
      feedback.textContent=`‚ùå Era: ${state.current.namePt} (${state.current.nameEn})`;
    }
    scoreBox.textContent = `Pontua√ß√£o: ${state.score} / ${state.rounds}`;
    setTimeout(nextRound,1000);
  }

  // ---------- Eventos ----------
  answerInp.addEventListener('keydown', e=>{
    if(e.key==='Enter'){
      e.preventDefault();
      handleAnswer(answerInp.value);
    }
  });
  answerInp.addEventListener('blur', ()=> answerInp.focus()); // mant√©m foco

  </script>
</body>
</html>
