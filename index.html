<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor de Pets Discord</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #5865F2 0%, #7289DA 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 30px;
        }

        .menu-section {
            margin-bottom: 25px;
        }

        .menu-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .option-card:hover {
            border-color: #5865F2;
            background: #f0f4ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(88, 101, 242, 0.2);
        }

        .option-card.selected {
            border-color: #5865F2;
            background: #e8ecff;
        }

        .option-icon {
            font-size: 32px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 10px;
        }

        .option-text h3 {
            font-size: 16px;
            color: #333;
            margin-bottom: 4px;
        }

        .option-text p {
            font-size: 13px;
            color: #666;
        }

        .input-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #5865F2;
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .input-hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #5865F2 0%, #7289DA 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(88, 101, 242, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .status-section {
            display: none;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .status-badge {
            background: #28a745;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .pulse {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .config-display {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .config-item:last-child {
            border-bottom: none;
        }

        .config-label {
            font-weight: 600;
            color: #666;
            font-size: 14px;
        }

        .config-value {
            color: #333;
            font-size: 14px;
        }

        .log-container {
            background: #2c2f33;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .log-entry {
            color: #b9bbbe;
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .log-entry.found {
            color: #43b581;
            font-weight: 600;
            font-size: 13px;
        }

        .log-entry.error {
            color: #f04747;
        }

        .log-entry.warning {
            color: #faa61a;
        }

        .pet-names-list {
            background: white;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }

        .pet-name-tag {
            display: inline-block;
            background: #5865F2;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            margin: 4px;
            font-size: 13px;
        }

        .config-section {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .config-section h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêæ Monitor de Pets Discord</h1>
            <p>Configure e monitore pets em tempo real</p>
        </div>

        <div class="content">
            <!-- Configura√ß√£o Inicial -->
            <div id="configSection" class="config-section">
                <h3>‚öôÔ∏è Configura√ß√£o Necess√°ria</h3>
                <div class="input-group">
                    <label>üîë Token do Discord</label>
                    <input type="password" id="discordToken" placeholder="Cole seu token aqui">
                    <div class="input-hint">Seu token N√ÉO ser√° salvo. Apenas usado nesta sess√£o.</div>
                </div>
                <div class="input-group">
                    <label>üì¢ ID do Canal</label>
                    <input type="text" id="channelId" value="1423778202932875434">
                    <div class="input-hint">ID do canal onde os pets aparecem</div>
                </div>
            </div>

            <!-- Menu de Op√ß√µes -->
            <div class="menu-section" id="menuSection">
                <div class="menu-title">‚öôÔ∏è Selecione o tipo de filtro</div>
                
                <div class="option-card" onclick="selectOption('money')">
                    <div class="option-icon">üí∞</div>
                    <div class="option-text">
                        <h3>Filtrar por Dinheiro/Segundo</h3>
                        <p>Defina um intervalo de valores em milh√µes</p>
                    </div>
                </div>

                <div class="option-card" onclick="selectOption('pet')">
                    <div class="option-icon">üêæ</div>
                    <div class="option-text">
                        <h3>Filtrar por Nome do Pet</h3>
                        <p>Monitore um pet espec√≠fico</p>
                    </div>
                </div>

                <div class="option-card" onclick="selectOption('multiple')">
                    <div class="option-icon">üß†</div>
                    <div class="option-text">
                        <h3>M√∫ltiplos Brainrots</h3>
                        <p>Monitore v√°rios pets ao mesmo tempo</p>
                    </div>
                </div>

                <div class="option-card" onclick="selectOption('all')">
                    <div class="option-icon">üîî</div>
                    <div class="option-text">
                        <h3>Monitorar Todos</h3>
                        <p>Receba notifica√ß√µes de todos os pets</p>
                    </div>
                </div>
            </div>

            <!-- Input: Filtro por Dinheiro -->
            <div class="input-section" id="moneyInput">
                <div class="menu-title">üí∞ Configure o filtro de dinheiro</div>
                <div class="input-group">
                    <label>Valor M√≠nimo (milh√µes)</label>
                    <input type="number" id="minMoney" placeholder="Ex: 40" step="0.1">
                    <div class="input-hint">Digite apenas o n√∫mero (ex: 40 para 40M)</div>
                </div>
                <div class="input-group">
                    <label>Valor M√°ximo (milh√µes)</label>
                    <input type="number" id="maxMoney" placeholder="Ex: 50" step="0.1">
                </div>
                <button class="btn" onclick="startMonitoring('money')">Iniciar Monitoramento</button>
                <button class="btn btn-secondary" onclick="backToMenu()">Voltar</button>
            </div>

            <!-- Input: Filtro por Nome -->
            <div class="input-section" id="petInput">
                <div class="menu-title">üêæ Configure o filtro por nome</div>
                <div class="input-group">
                    <label>Nome do Pet</label>
                    <input type="text" id="petName" placeholder="Ex: Quesadilla Crocodila">
                    <div class="input-hint">Digite o nome exato do pet</div>
                </div>
                <button class="btn" onclick="startMonitoring('pet')">Iniciar Monitoramento</button>
                <button class="btn btn-secondary" onclick="backToMenu()">Voltar</button>
            </div>

            <!-- Input: M√∫ltiplos Pets -->
            <div class="input-section" id="multipleInput">
                <div class="menu-title">üß† Configure m√∫ltiplos brainrots</div>
                <div class="input-group">
                    <label>Nomes dos Pets</label>
                    <textarea id="multipleNames" placeholder="Telemorte, Teletuba, Quesadilla Crocodila"></textarea>
                    <div class="input-hint">Separe os nomes com v√≠rgula</div>
                </div>
                <button class="btn" onclick="startMonitoring('multiple')">Iniciar Monitoramento</button>
                <button class="btn btn-secondary" onclick="backToMenu()">Voltar</button>
            </div>

            <!-- Status do Monitoramento -->
            <div class="status-section" id="statusSection">
                <div class="status-header">
                    <div class="status-title">Status do Monitoramento</div>
                    <div class="status-badge">
                        <div class="pulse"></div>
                        ATIVO
                    </div>
                </div>

                <div class="config-display" id="configDisplay"></div>

                <div class="log-container" id="logContainer">
                    <div class="log-entry">üîç Iniciando monitoramento...</div>
                </div>

                <button class="btn btn-secondary" onclick="stopMonitoring()" style="margin-top: 15px;">Parar Monitoramento</button>
            </div>
        </div>
    </div>

    <script>
        let currentFilter = null;
        let lastMessageId = null;
        let monitoringInterval = null;
        let TOKEN = '';
        let CHANNEL_ID = '';

        function selectOption(type) {
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });

            document.getElementById('menuSection').style.display = 'none';

            document.querySelectorAll('.input-section').forEach(section => {
                section.style.display = 'none';
            });

            if (type === 'money') {
                document.getElementById('moneyInput').style.display = 'block';
            } else if (type === 'pet') {
                document.getElementById('petInput').style.display = 'block';
            } else if (type === 'multiple') {
                document.getElementById('multipleInput').style.display = 'block';
            } else if (type === 'all') {
                startMonitoring('all');
            }
        }

        function backToMenu() {
            document.getElementById('menuSection').style.display = 'block';
            document.querySelectorAll('.input-section').forEach(section => {
                section.style.display = 'none';
            });
        }

        function extractMoneyPerSec(embeds) {
            for (let embed of embeds) {
                if (embed.fields) {
                    for (let field of embed.fields) {
                        if (field.name === 'üí∞ Money per sec') {
                            let value = field.value || '';
                            let cleanValue = value.replace(/[*_`~]/g, '');
                            
                            let match = cleanValue.match(/([\d,.]+)\s*[Mm]/);
                            if (match) {
                                let numStr = match[1].replace(/,/g, '');
                                return parseFloat(numStr);
                            }
                        }
                    }
                }
            }
            return 0;
        }

        function extractPetName(embeds) {
            for (let embed of embeds) {
                if (embed.fields) {
                    for (let field of embed.fields) {
                        if (field.name === 'üêæ Pet') {
                            let value = field.value || '';
                            return value.replace(/[*_`~]/g, '').trim();
                        }
                    }
                }
            }
            return '';
        }

        function extractJoinLink(embeds) {
            for (let embed of embeds) {
                if (embed.fields) {
                    for (let field of embed.fields) {
                        if (field.name === 'üîó Join Link') {
                            let value = field.value || '';
                            let match = value.match(/https?:\/\/[^\s)]+/);
                            if (match) {
                                return match[0];
                            }
                        }
                    }
                }
            }
            return null;
        }

        function checkFilter(embeds, filterConfig) {
            const name = extractPetName(embeds);
            const money = extractMoneyPerSec(embeds);

            if (filterConfig.type === 'money') {
                const min = parseFloat(filterConfig.min);
                const max = parseFloat(filterConfig.max);
                
                if (min <= money && money <= max) {
                    return { passes: true, name, money };
                }
            } else if (filterConfig.type === 'pet') {
                if (name.toLowerCase().includes(filterConfig.name.toLowerCase())) {
                    return { passes: true, name, money };
                }
            } else if (filterConfig.type === 'multiple') {
                const nameLower = name.toLowerCase();
                for (let targetName of filterConfig.names) {
                    if (nameLower.includes(targetName.toLowerCase())) {
                        return { passes: true, name, money, matchedName: targetName };
                    }
                }
            } else if (filterConfig.type === 'all') {
                return { passes: true, name, money };
            }

            return { passes: false, name, money };
        }

        let hasShownError = false;

        async function checkMessages() {
            if (!TOKEN || !CHANNEL_ID) {
                return;
            }

            try {
                const response = await fetch(`https://discord.com/api/v9/channels/${CHANNEL_ID}/messages`, {
                    headers: {
                        'Authorization': TOKEN
                    }
                });

                if (response.status === 401) {
                    if (!hasShownError) {
                        addLog('‚ùå Token inv√°lido! Verifique seu token.', 'error');
                        hasShownError = true;
                    }
                    stopMonitoring();
                    return;
                }

                if (response.status === 403) {
                    if (!hasShownError) {
                        addLog('‚ùå Sem permiss√£o para acessar este canal!', 'error');
                        hasShownError = true;
                    }
                    stopMonitoring();
                    return;
                }

                if (response.status === 429) {
                    return; // Silencioso no rate limit
                }

                if (response.status !== 200) {
                    return; // Silencioso em outros erros
                }

                const messages = await response.json();

                if (!messages || messages.length === 0) {
                    return;
                }

                if (lastMessageId === null) {
                    lastMessageId = messages[0].id;
                    addLog('‚úÖ Conectado! Aguardando novos pets...');
                    return;
                }

                for (let message of messages) {
                    if (message.id === lastMessageId) {
                        break;
                    }

                    if (message.embeds && message.embeds.length > 0) {
                        const result = checkFilter(message.embeds, currentFilter);

                        if (result.passes) {
                            const moneyStr = result.money ? `${result.money}M/s` : 'N/A';
                            
                            addLog('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'found');
                            addLog(`üéØ PET ENCONTRADO!`, 'found');
                            addLog(`üêæ ${result.name} / ${moneyStr}`, 'found');
                            
                            if (result.matchedName) {
                                addLog(`üß† Brainrot detectado: ${result.matchedName}`, 'found');
                            }
                            
                            const joinLink = extractJoinLink(message.embeds);
                            if (joinLink) {
                                addLog(`üîó Link: ${joinLink}`, 'found');
                                window.open(joinLink, '_blank');
                                addLog('‚úÖ Link aberto em nova aba!', 'found');
                            }
                            
                            addLog('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'found');

                            // Notifica√ß√£o do navegador
                            if (Notification.permission === 'granted') {
                                new Notification('üêæ Pet Encontrado!', {
                                    body: `${result.name} - ${moneyStr}`,
                                    icon: 'üêæ'
                                });
                            }
                        }
                    }
                }

                if (messages.length > 0) {
                    lastMessageId = messages[0].id;
                }

            } catch (error) {
                // Completamente silencioso - ignora TODOS os erros de fetch
            }
        }

        function startMonitoring(type) {
            TOKEN = document.getElementById('discordToken').value.trim();
            CHANNEL_ID = document.getElementById('channelId').value.trim();

            if (!TOKEN) {
                alert('‚ùå Digite o Token do Discord!');
                return;
            }

            if (!CHANNEL_ID) {
                alert('‚ùå Digite o ID do Canal!');
                return;
            }

            let config = { type: type };
            let configHTML = '';

            if (type === 'money') {
                const min = document.getElementById('minMoney').value;
                const max = document.getElementById('maxMoney').value;

                if (!min || !max) {
                    alert('‚ùå Preencha todos os campos!');
                    return;
                }

                if (parseFloat(min) > parseFloat(max)) {
                    alert('‚ùå Valor m√≠nimo n√£o pode ser maior que m√°ximo!');
                    return;
                }

                config.min = min;
                config.max = max;

                configHTML = `
                    <div class="config-item">
                        <span class="config-label">Tipo de Filtro:</span>
                        <span class="config-value">üí∞ Dinheiro por Segundo</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Intervalo:</span>
                        <span class="config-value">${min}M - ${max}M/s</span>
                    </div>
                `;
            } else if (type === 'pet') {
                const name = document.getElementById('petName').value.trim();

                if (!name) {
                    alert('‚ùå Digite o nome do pet!');
                    return;
                }

                config.name = name;

                configHTML = `
                    <div class="config-item">
                        <span class="config-label">Tipo de Filtro:</span>
                        <span class="config-value">üêæ Nome do Pet</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Pet Monitorado:</span>
                        <span class="config-value">${name}</span>
                    </div>
                `;
            } else if (type === 'multiple') {
                const namesInput = document.getElementById('multipleNames').value.trim();

                if (!namesInput) {
                    alert('‚ùå Digite pelo menos um nome!');
                    return;
                }

                const names = namesInput.split(',').map(n => n.trim()).filter(n => n);

                if (names.length === 0) {
                    alert('‚ùå Nenhum nome v√°lido encontrado!');
                    return;
                }

                config.names = names;

                const namesTags = names.map(n => `<span class="pet-name-tag">${n}</span>`).join('');

                configHTML = `
                    <div class="config-item">
                        <span class="config-label">Tipo de Filtro:</span>
                        <span class="config-value">üß† M√∫ltiplos Brainrots</span>
                    </div>
                    <div class="config-item" style="flex-direction: column; align-items: flex-start;">
                        <span class="config-label">Pets Monitorados (${names.length}):</span>
                        <div class="pet-names-list">${namesTags}</div>
                    </div>
                `;
            } else if (type === 'all') {
                configHTML = `
                    <div class="config-item">
                        <span class="config-label">Tipo de Filtro:</span>
                        <span class="config-value">üîî Todos os Pets</span>
                    </div>
                `;
            }

            currentFilter = config;

            // Esconde se√ß√µes anteriores
            document.getElementById('configSection').style.display = 'none';
            document.querySelectorAll('.input-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById('menuSection').style.display = 'none';

            // Mostra status
            document.getElementById('configDisplay').innerHTML = configHTML;
            document.getElementById('logContainer').innerHTML = '';
            document.getElementById('statusSection').style.display = 'block';

            addLog('üîç Iniciando monitoramento...');
            addLog('‚úÖ Sistema ativo! Aguardando pets...');
            addLog('üì± S√≥ vou avisar quando aparecer pet no seu filtro!');

            // Solicitar permiss√£o para notifica√ß√µes
            if (Notification.permission === 'default') {
                Notification.requestPermission();
            }

            // Inicia o monitoramento (10ms como no Python)
            lastMessageId = null;
            monitoringInterval = setInterval(checkMessages, 10);
        }

        function stopMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }

            currentFilter = null;
            lastMessageId = null;
            
            document.getElementById('statusSection').style.display = 'none';
            document.getElementById('configSection').style.display = 'block';
            backToMenu();
            
            addLog('üõë Monitoramento parado');
        }

        function addLog(message, type = 'normal') {
            const logContainer = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            if (type === 'found') {
                entry.classList.add('found');
            } else if (type === 'error') {
                entry.classList.add('error');
            } else if (type === 'warning') {
                entry.classList.add('warning');
            }

            const time = new Date().toLocaleTimeString('pt-BR');
            entry.textContent = `[${time}] ${message}`;
            
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
    </script>
</body>
</html>
